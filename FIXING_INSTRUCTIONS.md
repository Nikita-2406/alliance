# Инструкция по исправлению и запуску

## Исправленные проблемы

### 1. ❌ Отсутствие импорта `useRef` в `Home.jsx`
**Исправлено:** Добавлен `useRef` в импорты React

### 2. ❌ Нарушение правил React Hooks
**Проблема:** `useRef` вызывался внутри `.map()`, что нарушает правила хуков
**Исправлено:** Создан отдельный компонент `TopAppCard`, который использует `useRef` на верхнем уровне

### 3. ❌ CORS ошибка
**Проблема:** В `backend/ars/main/config.py` был указан неправильный порт `5273` вместо `5173`
**Исправлено:** Добавлен правильный порт `5173` в список разрешенных origins

### 4. ❌ Иконки приложений не отображались
**Проблема:** Неправильный базовый URL API и относительные пути к изображениям
**Исправлено:** 
- Изменен `API_BASE_URL` с `http://localhost:8000` на `http://localhost:8000/api`
- Обновлены все endpoints (убран префикс `/api/`)
- Добавлена функция `getFullUrl()` для преобразования путей к иконкам и скриншотам

## Шаги для запуска

### Шаг 1: Перезапустите бэкенд

**Важно!** Нужно перезапустить бэкенд, чтобы применились изменения CORS.

1. Остановите текущий процесс бэкенда (Ctrl+C)
2. Перейдите в папку бэкенда:
   ```bash
   cd backend/ars
   ```
3. Запустите снова:
   ```bash
   # Windows
   .\start.bat
   
   # Или напрямую через Python
   python -m main.main
   ```

### Шаг 2: Проверьте фронтенд

1. Убедитесь, что фронтенд запущен на порту 5173:
   ```bash
   cd app
   npm run dev
   # или
   yarn dev
   ```

2. Откройте браузер: http://localhost:5173/home

### Шаг 3: Проверьте консоль браузера

Откройте DevTools (F12) и проверьте:
- ✅ Нет ошибок CORS
- ✅ Нет ошибок с useRef
- ✅ Данные загружаются с API

## Что было изменено

### Файлы:
1. **`app/src/pages/Home/Home.jsx`**
   - Добавлен импорт `useRef`
   - Удален неиспользуемый `intervalRef`
   - Создан компонент `TopAppCard` для правильного использования хуков
   - Упрощен код рендеринга "Топ недели"

2. **`backend/ars/main/config.py`**
   - Добавлен порт `5173` в CORS_ORIGINS
   - Убраны wildcard записи с `*`

3. **`app/src/services/api.js`**
   - Изменен `API_BASE_URL` на `http://localhost:8000/api`
   - Обновлены все функции API (убран префикс `/api/` из endpoints)
   - Добавлена функция `getFullUrl()` для корректного формирования путей к изображениям
   - Иконки и скриншоты теперь загружаются с `http://localhost:8000/icons/` и `http://localhost:8000/screenshots/`

## Ожидаемый результат

После перезапуска бэкенда страница http://localhost:5173/home должна:
- ✅ Загружаться без ошибок
- ✅ Показывать карусель рекомендуемых приложений
- ✅ Показывать категории
- ✅ Показывать топ недели с прокручиваемыми скриншотами

## Если проблема остается

1. Проверьте, что бэкенд запущен: http://localhost:8000/health
2. Проверьте структуру данных API: http://localhost:8000/api/featured
3. Откройте консоль браузера (F12) и отправьте сообщение об ошибке
4. Проверьте, что база данных подключена корректно

